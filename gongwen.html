<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å…¬æ–‡è‡ªåŠ¨æ’°å†™åŠ©æ‰‹ V1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;500;600;700&display=swap');
        
        body { 
            background-color: #fcfcfc; 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            color: #1a1a1a;
        }
        
        /* å…¬æ–‡é¢„è§ˆåŒº - çº¯æ­£è¡¬çº¿ä½“ & ä¼˜åŒ–è¡Œè· */
        .doc-preview { 
            font-family: 'Noto Serif SC', 'SimSun', serif; 
            line-height: 2.2; /* è¾ƒå®½æ¾çš„è¡Œè·ï¼Œé€‚åˆé˜…è¯» */
            color: #000; 
        }
        .doc-preview h1 { font-weight: 700; font-size: 22pt; text-align: center; margin-bottom: 24pt; line-height: 1; }
        .doc-preview h2 { font-weight: 700; font-size: 16pt; margin-top: 18pt; margin-bottom: 12pt; }
        .doc-preview p { margin-bottom: 12pt; text-align: justify; font-size: 12pt; }
        .doc-preview ul, .doc-preview ol { margin-bottom: 12pt; padding-left: 2em; }
        
        /* éšè—æ»šåŠ¨æ¡ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* é»‘ç™½å‘¼å¸ç¯ */
        .thinking-pill {
            display: none;
            background: #fff;
            border: 1px solid #000;
            border-radius: 9999px;
            padding: 0.6rem 1.5rem;
            color: #000;
            font-size: 0.875rem;
            font-weight: 600;
            animation: breathe 3s infinite ease-in-out;
            margin: 0 auto 2rem auto;
            width: fit-content;
            box-shadow: 0 2px 0px rgba(0,0,0,1);
        }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }

        /* å¼•å¯¼æ°”æ³¡åŠ¨ç”» */
        .bubble-enter {
            animation: bubbleFadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        @keyframes bubbleFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æç®€è¾“å…¥æ¡†é£æ ¼ */
        .input-minimal {
            background-color: #fff;
            border: 1px solid #e5e5e5;
            transition: all 0.2s;
            color: #111;
        }
        .input-minimal:focus {
            border-color: #000;
            outline: none;
            box-shadow: 0 0 0 1px #000;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .label-bold {
            font-size: 0.875rem; 
            font-weight: 700;    
            color: #171717;      
            margin-bottom: 0.5rem;
            display: block;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        input, select, textarea { font-size: 16px !important; }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden">

    <nav class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center z-20 shrink-0 relative">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-red-600 text-white rounded flex items-center justify-center text-sm font-bold">
                å…¬
            </div>
            <div class="flex flex-col">
                <span class="text-sm font-bold tracking-tight text-black">å…¬æ–‡è‡ªåŠ¨æ’°å†™åŠ©æ‰‹</span>
                <span class="text-[10px] text-gray-500 font-medium uppercase tracking-wider">DeepSeek R1 Inside</span>
            </div>
        </div>
        
        <div class="flex items-center gap-4 relative">
            <a href="https://platform.deepseek.com/api_keys" target="_blank" class="text-xs font-medium text-gray-400 hover:text-black hover:underline transition-colors flex items-center gap-1">
                è·å– API Key 
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
            </a>
            <button onclick="toggleSettings()" class="text-gray-400 hover:text-black transition-colors" id="settingsBtn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>

            <div id="onboardingBubble" class="hidden absolute top-12 right-0 z-50 w-64 bubble-enter">
                <div class="relative bg-gray-900 text-white text-xs p-4 rounded-xl shadow-2xl">
                    <div class="absolute -top-1.5 right-2 w-3 h-3 bg-gray-900 transform rotate-45"></div>
                    
                    <div class="pr-5 leading-relaxed font-medium">
                        ğŸ‘‹ é¦–æ¬¡ä½¿ç”¨æ—¶è¯·è®¾ç½® <b>API Key</b>ï¼Œå‰å¾€ DeepSeek å®˜ç½‘è·å–å¹¶å……å€¼ 1 å…ƒå³å¯ã€‚
                    </div>
                    
                    <button onclick="closeBubble()" class="absolute top-1 right-1 p-2 text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div id="settingsModal" class="fixed inset-0 bg-white/90 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white border border-gray-200 shadow-2xl w-full max-w-sm p-8 rounded-lg transform transition-all scale-100">
            <h3 class="text-lg font-bold text-black mb-6 text-center">é…ç½® API Key</h3>
            <div class="mb-6">
                <input type="password" id="apiKeyInput" placeholder="sk-..." 
                       class="w-full bg-gray-50 border border-gray-200 rounded p-4 text-sm focus:border-black outline-none transition-all text-center tracking-widest">
            </div>
            <div class="flex gap-4">
                <button onclick="toggleSettings()" class="flex-1 px-4 py-3 text-gray-500 hover:text-black hover:bg-gray-50 rounded font-medium transition-colors">å–æ¶ˆ</button>
                <button onclick="saveSettings()" class="flex-1 px-4 py-3 bg-black text-white hover:bg-gray-800 rounded font-medium shadow-lg transition-all">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <div class="w-full md:w-[420px] bg-white border-b md:border-b-0 md:border-r border-gray-200 flex flex-col z-10">
            <div class="flex-1 overflow-y-auto p-6 md:p-8 space-y-8 no-scrollbar">
                
                <div class="space-y-6">
                    <div>
                        <label class="label-bold">æ–‡ç§ç±»å‹</label>
                        <div class="relative">
                            <select id="docType" class="w-full input-minimal rounded-lg p-3 text-sm appearance-none font-medium">
                                <option value="æ ¹æ®å†…å®¹è‡ªåŠ¨åŒ¹é…æ–‡ç§">âœ¨ æ™ºèƒ½åŒ¹é…</option>
                                <option value="å·¥ä½œæ€»ç»“">ğŸ“ˆ å·¥ä½œæ€»ç»“</option>
                                <option value="å·¥ä½œè®¡åˆ’">ğŸ“… å·¥ä½œè®¡åˆ’</option>
                                <option value="å·¥ä½œé€šçŸ¥">ğŸ“¢ å·¥ä½œé€šçŸ¥</option>
                                <option value="ä¼šè®®çºªè¦">ğŸ“ ä¼šè®®çºªè¦</option>
                                <option value="è¯·ç¤ºæŠ¥å‘Š">ğŸ“„ è¯·ç¤ºæŠ¥å‘Š</option>
                                <option value="å·¥ä½œæ–¹æ¡ˆ">ğŸ“Š å·¥ä½œæ–¹æ¡ˆ</option>
                                <option value="é¢†å¯¼è®²è¯">ğŸ™ï¸ é¢†å¯¼è®²è¯</option>
                                <option value="æ¥å¾€å…¬å‡½">âœ‰ï¸ æ¥å¾€å…¬å‡½</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                    </div>

                    <div>
                         <label class="label-bold flex justify-between items-center">
                            èƒŒæ™¯ä¿¡æ¯ <span class="text-xs font-normal text-gray-400">é€‰å¡«</span>
                        </label>
                        <textarea id="orgContext" rows="3" class="w-full input-minimal rounded-lg p-3 text-sm resize-none" placeholder="ä¾‹å¦‚ï¼šxxxå…¬å¸ï¼Œæ ¸å¿ƒä¸šåŠ¡æ˜¯..."></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="label-bold">æ’°ç¨¿è€…è§’è‰²</label>
                            <input type="text" id="authorIdentity" placeholder="å¦‚ï¼šå²—ä½ã€éƒ¨é—¨å" class="w-full input-minimal rounded-lg p-3 text-sm">
                        </div>
                        <div>
                            <label class="label-bold">é˜…è¯»å¯¹è±¡ *</label>
                            <input type="text" id="targetAudience" placeholder="å¦‚ï¼šéƒ¨é—¨é¢†å¯¼ã€å…¨ä½“äººå‘˜" class="w-full input-minimal rounded-lg p-3 text-sm bg-gray-50 focus:bg-white">
                        </div>
                    </div>
                </div>

                <div class="flex-1 flex flex-col min-h-[200px]">
                    <label class="label-bold">ç´ æ/æ„å›¾/èƒŒæ™¯</label>
                    <textarea id="userInput" class="flex-1 w-full input-minimal rounded-lg p-4 text-sm leading-relaxed resize-none"
                              placeholder="è¯·åœ¨æ­¤è¾“å…¥AIè¿˜ä¸äº†è§£çš„å…³é”®ä¿¡æ¯ã€‚&#10;ä¾‹å¦‚ï¼šä¸‹å‘¨ä¸€è¦åœ¨ä¼šè®®å®¤å¼€ä¼šï¼Œè®¨è®ºå¹´åº¦é¢„ç®—ï¼Œææ€»ä¸»æŒï¼Œå„éƒ¨é—¨è´Ÿè´£äººå¿…é¡»å¸¦æŠ¥è¡¨å‚åŠ ã€‚"></textarea>
                </div>
            </div>

            <div class="p-6 pb-10 md:pb-6 bg-white border-t border-gray-100">
                <button onclick="generateDoc()" id="submitBtn" class="group w-full bg-black hover:bg-gray-800 text-white font-bold py-4 rounded-lg shadow-xl shadow-gray-200 transition-all transform active:scale-[0.98] flex justify-center items-center gap-2 text-base">
                    <span>å¼€å§‹æ’°å†™</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                </button>
            </div>
        </div>

        <div class="w-full md:w-auto flex-1 bg-[#f5f5f5] relative flex flex-col h-full">
            <div class="flex-1 overflow-y-auto p-4 md:p-12" id="previewContainer">
                
                <div id="thinkingIndicator" class="thinking-pill">
                    <span class="flex items-center gap-2">
                        <span class="relative flex h-2.5 w-2.5">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-black opacity-25"></span>
                          <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-black"></span>
                        </span>
                        AI æ­£åœ¨è¿ç¬”...
                    </span>
                </div>

                <div class="max-w-[21cm] mx-auto bg-white shadow-sm min-h-[29.7cm] p-12 md:p-[2.54cm] rounded-sm relative transition-all duration-500 ease-out" id="paperCard">
                    
                    <div class="absolute top-4 right-4 flex gap-2">
                         <button onclick="copyResult()" class="p-2 rounded text-gray-400 hover:text-black hover:bg-gray-100 transition-all flex items-center gap-1 text-xs font-bold" title="å¤åˆ¶å†…å®¹">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            å¤åˆ¶
                        </button>
                        <button onclick="exportToWord()" class="p-2 rounded text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-all flex items-center gap-1 text-xs font-bold" title="å¯¼å‡ºWord">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            å¯¼å‡º Word
                        </button>
                    </div>

                    <div id="resultOutput" class="doc-preview">
                        <div class="flex flex-col items-center justify-center h-96 text-gray-300 select-none">
                            <div class="mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            <p class="text-sm font-medium text-gray-400">è¯·åœ¨å·¦ä¾§è¾“å…¥ä¿¡æ¯</p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-8 text-gray-300 text-[10px] font-mono">GENERATED BY DEEPSEEK R1</div>
            </div>
        </div>
    </div>

    <script>
        // === ç³»ç»Ÿæç¤ºè¯ ===
        const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œã€ç¬”é£ä¸¥è°¨çš„èµ„æ·±æœºå…³å…¬æ–‡å†™ä½œä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ç”¨æˆ·æä¾›çš„ç¢ç‰‡åŒ–ä¿¡æ¯ï¼Œè½¬åŒ–ä¸ºæ ¼å¼è§„èŒƒã€ç”¨è¯ç²¾å‡†ã€é€»è¾‘ä¸¥å¯†çš„æ­£å¼å…¬æ–‡ã€‚

ã€æ ¸å¿ƒåŸåˆ™ã€‘
1. èº«ä»½ä»£å…¥ï¼šä½ ä¸æ˜¯èŠå¤©æœºå™¨äººï¼Œä½ æ˜¯å•ä½çš„â€œç¬”æ†å­â€ã€‚
2. è¯­è¨€é£æ ¼ï¼š
   - ä½¿ç”¨æ ‡å‡†å®˜æ–¹è¯­è¨€ä½“ç³»ï¼Œæœç»å£è¯­ã€ç½‘ç»œç”¨è¯­å’Œæƒ…ç»ªåŒ–è¡¨è¾¾ã€‚
   - åŠ¨è¯è¦ç²¾å‡†æœ‰åŠ›ï¼ˆå¦‚å°†â€œæ‰“ç®—åšâ€æ”¹ä¸ºâ€œæ‹Ÿå®æ–½â€ï¼Œå°†â€œå¤§å®¶éƒ½è¦æ¥â€æ”¹ä¸ºâ€œå…¨å‘˜è¦†ç›–â€ï¼‰ã€‚
   - å¥å¼è¦æ•´æ•£ç»“åˆï¼Œå¤šç”¨å››å­—çŸ­è¯­ï¼Œå¢å¼ºæ°”åŠ¿å’ŒèŠ‚å¥æ„Ÿã€‚
   - å¦‚æœé€‚ç”¨ï¼Œå¤šä½¿ç”¨æ•°æ®ã€‚
3. ç»“æ„è§„èŒƒï¼šä¸¥æ ¼éµå®ˆã€Šå…šæ”¿æœºå…³å…¬æ–‡å¤„ç†å·¥ä½œæ¡ä¾‹ã€‹æ ¼å¼è¦æ±‚ï¼Œæ ‡é¢˜åˆ†çº§æ˜ç¡®ï¼ˆä¸€ã€(ä¸€)ã€1ã€(1)ï¼‰ã€‚
4. æ ¼å¼ç¾è§‚ï¼šç”Ÿæˆçš„Markdownåº”åˆç†ä½¿ç”¨æ ‡é¢˜ã€åŠ ç²—å’Œåˆ—è¡¨ã€‚

ã€æ’°å†™æ­¥éª¤ã€‘
1. æ„å›¾è¯†åˆ«ï¼šåˆ†æç”¨æˆ·è¾“å…¥çš„æ‚ä¹±ä¿¡æ¯ï¼Œæç‚¼æ ¸å¿ƒä¸»æ—¨ã€‚
2. æ¡†æ¶æ­å»ºï¼šæ ¹æ®æ–‡ç§ï¼ˆé€šçŸ¥/æ€»ç»“/æ–¹æ¡ˆç­‰ï¼‰åŒ¹é…æ ‡å‡†å…¬æ–‡ç»“æ„ã€‚
3. å†…å®¹å¡«å……ï¼šå°†ç´ æå¡«å…¥æ¡†æ¶ï¼Œå¹¶è¿›è¡Œé€»è¾‘è¡¥å…¨ï¼ˆå¦‚ç¼ºå°‘çš„èƒŒæ™¯ã€æ„ä¹‰ã€è¦æ±‚ç­‰ï¼‰ã€‚
4. è¯­è¨€æ¶¦è‰²ï¼šç”¨å®˜æ–¹å…¬æ–‡è¯­æ€è¿›è¡Œæœ€ç»ˆæ‰“ç£¨ã€‚`;

        // é¡µé¢åŠ è½½é€»è¾‘
        window.onload = function() {
            const savedKey = localStorage.getItem('deepseek_api_key');
            if (savedKey) {
                document.getElementById('apiKeyInput').value = savedKey;
            } else {
                // ğŸ”´ ä¿®æ”¹ï¼šæ²¡æœ‰ Key æ—¶ï¼Œæ˜¾ç¤ºæ°”æ³¡ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨å¼¹çª—
                document.getElementById('onboardingBubble').classList.remove('hidden');
            }
        }

        // å…³é—­æ°”æ³¡
        function closeBubble() {
            document.getElementById('onboardingBubble').classList.add('hidden');
        }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.classList.toggle('hidden');
        }

        function saveSettings() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                localStorage.setItem('deepseek_api_key', key);
                toggleSettings();
                closeBubble(); // ä¿å­˜æˆåŠŸåè‡ªåŠ¨å…³é—­æ°”æ³¡
            } else alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ API Key');
        }

        async function generateDoc() {
            const apiKey = localStorage.getItem('deepseek_api_key');
            
            const docType = document.getElementById('docType').value;
            const orgContext = document.getElementById('orgContext').value.trim();
            const author = document.getElementById('authorIdentity').value.trim() || "åŠå…¬å®¤";
            const audience = document.getElementById('targetAudience').value.trim();
            const userInput = document.getElementById('userInput').value.trim();
            
            const outputDiv = document.getElementById('resultOutput');
            const thinkingDiv = document.getElementById('thinkingIndicator');
            const btn = document.getElementById('submitBtn');

            if (!apiKey) { 
                alert('è¯·å…ˆè®¾ç½® API Key'); 
                toggleSettings(); 
                return; 
            }
            if (!audience) { alert('è¯·å¡«å†™é˜…è¯»å¯¹è±¡'); document.getElementById('targetAudience').focus(); return; }
            if (!userInput) { alert('è¯·è¾“å…¥æ ¸å¿ƒç´ æ'); document.getElementById('userInput').focus(); return; }

            if (window.innerWidth < 768) document.getElementById('previewContainer').scrollIntoView({ behavior: 'smooth' });

            btn.disabled = true;
            btn.innerHTML = 'æ­£åœ¨æ’°å†™...';
            outputDiv.innerHTML = ''; 
            thinkingDiv.style.display = 'block'; 

            let contextPrompt = "";
            if (orgContext) {
                contextPrompt = `ã€å‘æ–‡/æ’°å†™äººå•ä½èƒŒæ™¯ã€‘ï¼š${orgContext}\n`;
            }

            const fullPrompt = `è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚æ’°å†™å…¬æ–‡ï¼š

${contextPrompt}ã€ç›®æ ‡æ–‡ç§ã€‘ï¼š${docType}
ã€æ’°ç¨¿è€…è§’è‰²ã€‘ï¼š${author}
ã€é˜…è¯»å¯¹è±¡ã€‘ï¼š${audience}

ã€ç´ æ/æ„å›¾/èƒŒæ™¯ã€‘ï¼š
${userInput}

ã€æ‰§è¡Œè¦æ±‚ã€‘ï¼š
è¯·å…ˆåœ¨å†…å¿ƒæ€è€ƒå…¬æ–‡çš„é€»è¾‘æ¡†æ¶ï¼ˆDeepSeek R1 Thinkingï¼‰ï¼Œä½†ä¸è¦åœ¨æœ€ç»ˆç»“æœä¸­è¾“å‡ºæ€è€ƒè¿‡ç¨‹ã€‚
ç›´æ¥è¾“å‡ºæœ€ç»ˆçš„å…¬æ–‡æ­£æ–‡ã€‚æ­£æ–‡è¦æ ‡é¢˜å±‚çº§æ¸…æ™°ï¼Œè¯­è¨€åº„é‡å¾—ä½“ï¼Œç¬¦åˆå…¬æ–‡è§„èŒƒã€‚`;

            let accumulatedText = ""; 
            
            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                    body: JSON.stringify({
                        model: "deepseek-reasoner",
                        messages: [ 
                            { role: "system", content: SYSTEM_PROMPT }, 
                            { role: "user", content: fullPrompt } 
                        ],
                        stream: true,
                        temperature: 0.6 
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error?.message || 'è¯·æ±‚å¤±è´¥');
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder("utf-8");

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const dataStr = line.slice(6);
                            if (dataStr === '[DONE]') break;
                            try {
                                const data = JSON.parse(dataStr);
                                const content = data.choices[0].delta.content || "";
                                
                                accumulatedText += content;

                                if (accumulatedText.includes('</think>')) {
                                    thinkingDiv.style.display = 'none';
                                }

                                const cleanContent = accumulatedText.replace(/<think>[\s\S]*?<\/think>/g, "").replace(/<think>[\s\S]*/g, "").trim();
                                
                                if (cleanContent.length > 5 && thinkingDiv.style.display !== 'none') {
                                     thinkingDiv.style.display = 'none';
                                }

                                if (cleanContent) {
                                    outputDiv.innerHTML = marked.parse(cleanContent);
                                }
                                
                            } catch (e) { console.error(e); }
                        }
                    }
                }

            } catch (error) {
                console.error("Error:", error);
                thinkingDiv.style.display = 'none';
                outputDiv.innerHTML = `<div class="p-4 bg-red-50 text-red-600 rounded-lg text-sm text-center">âš ï¸ å‡ºé”™äº†ï¼š${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>å¼€å§‹æ’°å†™</span><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>`;
                thinkingDiv.style.display = 'none';
            }
        }

        function copyResult() {
            const text = document.getElementById('resultOutput').innerText;
            if(text && !text.includes('è¯·åœ¨å·¦ä¾§è¾“å…¥')) {
                navigator.clipboard.writeText(text).then(() => {
                    const btn = document.querySelector('button[title="å¤åˆ¶å†…å®¹"]');
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = `<span class="text-green-600">å·²å¤åˆ¶</span>`;
                    setTimeout(() => btn.innerHTML = originalHTML, 2000);
                });
            }
        }

        function exportToWord() {
            const content = document.getElementById('resultOutput');
            const text = content.innerText;
            if(!text || text.includes('è¯·åœ¨å·¦ä¾§è¾“å…¥')) {
                alert('æš‚æ— å†…å®¹å¯å¯¼å‡º');
                return;
            }

            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: 'SimSun', 'Songti SC', serif; line-height: 2.2; }
                        h1 { text-align: center; font-size: 22pt; font-weight: bold; margin-bottom: 24pt; }
                        h2 { font-size: 16pt; font-weight: bold; margin-top: 18pt; margin-bottom: 12pt; }
                        p { font-size: 12pt; margin-bottom: 12pt; text-align: justify; }
                        ul, ol { margin-bottom: 12pt; }
                    </style>
                </head>
                <body>
                    ${content.innerHTML}
                </body>
                </html>
            `;

            try {
                const converted = htmlDocx.asBlob(htmlContent, {
                    orientation: 'portrait',
                    margins: {top: 720, bottom: 720, left: 1440, right: 1440}
                });
                saveAs(converted, `å…¬æ–‡è‡ªåŠ¨æ’°å†™_${new Date().toISOString().slice(0,10)}.docx`);
            } catch (e) {
                console.error(e);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œå»ºè®®ç›´æ¥å¤åˆ¶å†…å®¹åˆ° Word ä¸­ã€‚');
            }
        }
    </script>
    <script src="common.js"></script>
</body>
</html>


