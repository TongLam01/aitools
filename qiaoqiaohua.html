<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§å¯†æ–‡æœ¬åˆ†äº«å™¨ (AESåŠ å¯†ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    <style>
        :root { --primary: #059669; --bg: #f0fdf4; }
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 700px; margin: 40px auto; padding: 20px; background: var(--bg); color: #064e3b; }
        .card { background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #d1fae5; }
        h2 { margin-top: 0; color: var(--primary); }
        textarea, input { width: 100%; padding: 12px; border: 1px solid #a7f3d0; border-radius: 8px; margin-bottom: 1rem; box-sizing: border-box; font-size: 1rem; }
        textarea { height: 150px; }
        button { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; transition: background 0.2s; }
        button:hover { background: #047857; }
        #link-output { margin-top: 1.5rem; word-break: break-all; padding: 1rem; background: #ecfdf5; border-radius: 8px; display: none; border: 1px dashed var(--primary); }
        .hidden { display: none; }
        .content-box { white-space: pre-wrap; background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #e5e7eb; min-height: 100px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ”’ ç§å¯†æ–‡æœ¬åˆ†äº«å™¨</h2>

        <div id="input-section">
            <textarea id="text-input" placeholder="è¾“å…¥ä½ æƒ³åŠ å¯†åˆ†äº«çš„å†…å®¹..."></textarea>
            <input type="password" id="password-input" placeholder="è®¾ç½®è®¿é—®å¯†ç  (å¿…å¡«)">
            <button onclick="generateSecureLink()">ç”ŸæˆåŠ å¯†åˆ†äº«é“¾æ¥</button>
            <div id="link-output"></div>
        </div>

        <div id="unlock-section" class="hidden">
            <p>å†…å®¹å·²è¢«åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç æŸ¥çœ‹ï¼š</p>
            <input type="password" id="decrypt-password" placeholder="è¾“å…¥è®¿é—®å¯†ç ">
            <button onclick="unlockContent()">è§£é”å†…å®¹</button>
        </div>

        <div id="view-section" class="hidden">
            <p><strong>è§£å¯†æˆåŠŸï¼š</strong></p>
            <div id="content-display" class="content-box"></div>
            <br>
            <button onclick="location.href = location.pathname" style="background: #6b7280;">æˆ‘ä¹Ÿè¦å‘ä¸€æ¡</button>
        </div>
    </div>

    <script>
        // ç”ŸæˆåŠ å¯†é“¾æ¥é€»è¾‘
        function generateSecureLink() {
            const text = document.getElementById('text-input').value;
            const pwd = document.getElementById('password-input').value;
            
            if (!text || !pwd) return alert("å†…å®¹å’Œå¯†ç éƒ½ä¸èƒ½ä¸ºç©ºï¼");

            // 1. AES åŠ å¯†
            const encrypted = CryptoJS.AES.encrypt(text, pwd).toString();
            // 2. LZ-String å‹ç¼© (ä¸ºäº†ç¼©çŸ­ URL)
            const compressed = LZString.compressToEncodedURIComponent(encrypted);
            
            const shareUrl = window.location.origin + window.location.pathname + '#' + compressed;
            
            const output = document.getElementById('link-output');
            output.style.display = 'block';
            output.innerHTML = `<strong>åˆ†äº«é“¾æ¥ï¼š</strong><br><small>ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å¤åˆ¶</small><br><br><a href="${shareUrl}">${shareUrl}</a>`;
        }

        // è§£é”é€»è¾‘
        function unlockContent() {
            const hash = window.location.hash.substring(1);
            const pwd = document.getElementById('decrypt-password').value;
            
            try {
                // 1. å…ˆè§£å‹
                const encrypted = LZString.decompressFromEncodedURIComponent(hash);
                // 2. å†è§£å¯†
                const bytes = CryptoJS.AES.decrypt(encrypted, pwd);
                const originalText = bytes.toString(CryptoJS.enc.Utf8);

                if (!originalText) throw new Error("å¯†ç é”™è¯¯");

                document.getElementById('unlock-section').classList.add('hidden');
                document.getElementById('view-section').classList.remove('hidden');
                document.getElementById('content-display').textContent = originalText;
            } catch (e) {
                alert("å¯†ç é”™è¯¯æˆ–æ•°æ®æŸåï¼Œæ— æ³•è§£å¯†ï¼");
            }
        }

        // åˆå§‹åŒ–åˆ¤æ–­
        window.onload = function() {
            if (window.location.hash) {
                document.getElementById('input-section').classList.add('hidden');
                document.getElementById('unlock-section').classList.remove('hidden');
            }
        };
    </script>
</body>
</html>
