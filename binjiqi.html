<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI çµæ„Ÿæ’ç‰ˆå¤§å¸ˆ - ä¸“å®¶çº§æ¨¡æ¿ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #preview-container { 
            background: #f0f2f5; min-height: 650px; border-radius: 40px;
            padding: 12px; border: 10px solid #222; max-width: 380px; margin: 0 auto;
        }
        #preview-content {
            background: white; height: 100%; min-height: 600px;
            overflow-y: auto; padding: 20px; outline: none; border-radius: 30px;
        }
        /* é€‰ä¸­å—çš„æ ·å¼ */
        .selected-block {
            outline: 2px dashed #3b82f6 !important;
            background-color: #f8fafc !important;
            cursor: pointer;
        }
        .style-btn { @apply px-3 py-1 bg-slate-100 hover:bg-blue-100 text-xs rounded transition-all border border-slate-200; }
        ::-webkit-scrollbar { width: 4px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-20">

    <div class="max-w-7xl mx-auto py-10 px-4 flex flex-col lg:flex-row gap-8">
        
        <div class="flex-1 space-y-6">
            <header>
                <h1 class="text-3xl font-black text-slate-800 tracking-tight">ğŸ–‹ï¸ AI æ’ç‰ˆä¸“å®¶ <span class="text-sm font-normal text-slate-400">v3.0</span></h1>
            </header>

            <div class="bg-white p-4 rounded-xl shadow-sm border flex gap-4 items-center">
                <input type="password" id="api-key" oninput="saveConfig()" class="flex-1 p-2 bg-slate-50 border rounded-lg text-sm outline-none" placeholder="DeepSeek API Key">
                <button onclick="clearStorage()" class="text-xs text-slate-400">æ¸…ç©º</button>
            </div>

            <textarea id="user-input" class="w-full h-96 p-6 bg-white border border-slate-200 rounded-2xl shadow-inner focus:ring-2 focus:ring-blue-600 outline-none" placeholder="è¾“å…¥æ–‡ç« å†…å®¹..."></textarea>

            <button id="btn-run" onclick="generateArticle()" class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-all shadow-xl">
                ğŸš€ AI æ™ºèƒ½è§£æå¹¶æ’ç‰ˆ
            </button>
        </div>

        <div class="w-full lg:w-[450px] space-y-4">
            <div class="flex justify-between items-center px-4">
                <h2 class="font-bold text-slate-600">ç‚¹å‡»å†…å®¹å¯å•ç‹¬æ¢æ ·å¼</h2>
                <button onclick="copyHtml()" class="px-5 py-2 bg-green-600 text-white text-sm font-bold rounded-full shadow-lg">ğŸ“‹ å¤åˆ¶</button>
            </div>

            <div id="preview-container">
                <div id="preview-content" onclick="handlePreviewClick(event)">
                    <div style="margin-top:200px; text-align:center; color:#ccc;">ç­‰å¾…ç”Ÿæˆ...</div>
                </div>
            </div>

            <div id="block-tools" class="hidden bg-white p-4 rounded-2xl shadow-2xl border border-blue-100 space-y-3">
                <p class="text-[10px] font-bold text-blue-500 uppercase">é’ˆå¯¹é€‰ä¸­æ®µè½ä¿®æ”¹æ ·å¼ï¼š</p>
                <div class="flex flex-wrap gap-2" id="template-options">
                    </div>
            </div>
        </div>
    </div>

    <script>
        let selectedElement = null;

        // 1. ç²¾ç»†åŒ–æ¨¡æ¿åº“ (Inline CSS ä¸“å®¶çº§è®¾è®¡)
        const TEMPLATES = {
            big_title: `<section style="margin: 2em 0 1em; text-align: center;"><h1 style="font-size: 24px; color: #333; border-bottom: 2px solid #333; display: inline-block; padding-bottom: 5px;">{{text}}</h1></section>`,
            sub_title: `<section style="margin: 1.5em 0 1em; padding-left: 10px; border-left: 4px solid #3b82f6;"><h2 style="font-size: 18px; color: #1e293b; margin: 0;">{{text}}</h2></section>`,
            num_title: `<section style="margin: 1.5em 0; display: flex; align-items: center;"><span style="background: #3b82f6; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 14px; font-weight: bold;">N</span><h3 style="font-size: 17px; margin: 0; color: #333;">{{text}}</h3></section>`,
            grad_title: `<section style="margin: 1.5em 0; background: linear-gradient(90deg, #eff6ff 0%, #ffffff 100%); padding: 10px; border-radius: 4px;"><h2 style="font-size: 18px; color: #2563eb; margin: 0;">{{text}}</h2></section>`,
            key_point: `<section style="margin: 1.5em 0; padding: 20px; border: 1px solid #bfdbfe; background: #eff6ff; border-radius: 12px; color: #1e40af;"><strong style="display: block; margin-bottom: 5px;">ğŸ“ é‡ç‚¹</strong>{{text}}</section>`,
            quote: `<section style="margin: 1.5em 0; padding: 15px; border-left: 4px solid #cbd5e1; color: #64748b; font-style: italic; background: #f8fafc;">{{text}}</section>`,
            code_block: `<section style="margin: 1.5em 0; padding: 15px; background: #1e293b; color: #e2e8f0; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap;">{{text}}</section>`,
            bg_card: `<section style="margin: 1.5em 0; padding: 20px; background: #f1f5f9; border-radius: 8px; color: #334155;">{{text}}</section>`,
            normal: `<section style="margin: 1.2em 0; line-height: 1.8; font-size: 16px; color: #374151; text-align: justify;">{{text}}</section>`
        };

        const STYLE_NAMES = {
            big_title: "å¤§æ ‡é¢˜", sub_title: "å°æ ‡é¢˜", num_title: "ç¼–å·æ ‡é¢˜",
            grad_title: "æ¸å˜æ ‡é¢˜", key_point: "é‡ç‚¹", quote: "å¼•ç”¨",
            code_block: "ä»£ç å—", bg_card: "åº•è‰²å¡ç‰‡", normal: "æ™®é€šæ­£æ–‡"
        };

        // 2. åˆå§‹åŒ–
        window.onload = () => {
            const savedKey = localStorage.getItem('ds_api_key');
            if (savedKey) document.getElementById('api-key').value = savedKey;
            
            // ç”Ÿæˆæ ·å¼åˆ‡æ¢æŒ‰é’®
            const btnContainer = document.getElementById('template-options');
            Object.keys(TEMPLATES).forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'style-btn';
                btn.innerText = STYLE_NAMES[key];
                btn.onclick = () => applyTemplate(key);
                btnContainer.appendChild(btn);
            });
        };

        function saveConfig() { localStorage.setItem('ds_api_key', document.getElementById('api-key').value); }
        function clearStorage() { localStorage.clear(); location.reload(); }

        // 3. æ ¸å¿ƒï¼šAI è§£æé€»è¾‘
        async function generateArticle() {
            const apiKey = document.getElementById('api-key').value;
            const text = document.getElementById('user-input').value;
            const btn = document.getElementById('btn-run');
            if (!apiKey || !text) return alert("ä¿¡æ¯ä¸è¶³");

            btn.disabled = true;
            btn.innerText = "AI æ­£åœ¨ç†è§£æ–‡ç« ç»“æ„...";

            // æ„é€ ç²¾ç»†åŒ– Prompt
            const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªå…¬ä¼—å·è§†è§‰ä¸“å®¶ã€‚è¯·åˆ†æç”¨æˆ·æ–‡æœ¬ï¼Œå°†å…¶æ‹†åˆ†ä¸ºé€»è¾‘å—ï¼Œå¹¶ä¸ºæ¯ä¸ªå—é€‰æ‹©ä»¥ä¸‹æœ€åŒ¹é…çš„æ¨¡æ¿ï¼š
            1. big_title: ç”¨äºæ–‡ç« ä¸»æ ‡é¢˜
            2. sub_title: ç”¨äºäºŒçº§å°æ ‡é¢˜
            3. num_title: ç”¨äºå¸¦åºå·çš„å¹¶åˆ—æ ‡é¢˜
            4. grad_title: ç”¨äºå¼ºè°ƒå‹æ ‡é¢˜
            5. key_point: ç”¨äºæ ¸å¿ƒç»“è®ºæˆ–è­¦å‘Š
            6. quote: ç”¨äºåè¨€æˆ–ä»–äººè§‚ç‚¹
            7. code_block: ç”¨äºä¸“ä¸šæœ¯è¯­è§£é‡Šæˆ–ä»£ç 
            8. bg_card: ç”¨äºè¡¥å……èƒŒæ™¯çŸ¥è¯†
            9. normal: ç”¨äºä¸€èˆ¬æè¿°
            
            è¦æ±‚ï¼šè¾“å‡ºçº¯HTMLï¼Œæ¯ä¸ªå—å¿…é¡»æ˜¯ç‹¬ç«‹çš„ <section> æ ‡ç­¾ã€‚ç¦æ­¢è¾“å‡º Markdown æ ¼å¼ã€‚`;

            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "system", content: systemPrompt }, { role: "user", content: text }],
                        temperature: 0.3
                    })
                });
                const data = await response.json();
                let html = data.choices[0].message.content.replace(/```html|```/gi, '').trim();
                
                // ç»™æ¯ä¸ªç”Ÿæˆçš„ section åŠ ä¸Š data-raw å­˜å‚¨çº¯æ–‡æœ¬
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                doc.querySelectorAll('section').forEach(s => {
                    s.setAttribute('data-raw', s.innerText);
                    s.style.transition = "0.3s";
                });
                
                document.getElementById('preview-content').innerHTML = doc.body.innerHTML;
            } catch (error) { alert("API è°ƒç”¨å¤±è´¥"); }
            finally { btn.disabled = false; btn.innerText = "ğŸš€ AI æ™ºèƒ½è§£æå¹¶æ’ç‰ˆ"; }
        }

        // 4. äº¤äº’å¾®è°ƒé€»è¾‘
        function handlePreviewClick(e) {
            const target = e.target.closest('section');
            if (!target) return;

            // æ¸…é™¤æ—§çš„é€‰ä¸­çŠ¶æ€
            if (selectedElement) selectedElement.classList.remove('selected-block');
            
            selectedElement = target;
            selectedElement.classList.add('selected-block');
            
            // æ˜¾ç¤ºå·¥å…·æ 
            document.getElementById('block-tools').classList.remove('hidden');
        }

        function applyTemplate(type) {
            if (!selectedElement) return;
            const rawText = selectedElement.getAttribute('data-raw');
            const newHtml = TEMPLATES[type].replace('{{text}}', rawText);
            
            // åˆ›å»ºä¸´æ—¶å®¹å™¨è§£ææ–° HTML
            const temp = document.createElement('div');
            temp.innerHTML = newHtml;
            const newElement = temp.firstElementChild;
            
            // ç»§æ‰¿åŸå§‹æ–‡æœ¬å±æ€§
            newElement.setAttribute('data-raw', rawText);
            newElement.classList.add('selected-block');
            
            selectedElement.replaceWith(newElement);
            selectedElement = newElement;
        }

        async function copyHtml() {
            const content = document.getElementById('preview-content').cloneNode(true);
            // å¤åˆ¶å‰ç§»é™¤è¾…åŠ©ç±»å
            content.querySelectorAll('.selected-block').forEach(el => el.classList.remove('selected-block'));
            
            const type = "text/html";
            const blob = new Blob([content.innerHTML], { type });
            const data = [new ClipboardItem({ [type]: blob })];
            await navigator.clipboard.write(data);
            alert("âœ… æ ·å¼å·²å¤åˆ¶ï¼");
        }
    </script>
</body>
</html>
