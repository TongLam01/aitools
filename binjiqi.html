<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI çµæ„Ÿæ’ç‰ˆå¤§å¸ˆ v7.0 - ç¨³å®šä¿®å¤ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #3b82f6; }
        
        #preview-container { 
            background: #111; min-height: 600px; border-radius: 40px;
            padding: 10px; border: 6px solid #333; max-width: 375px; margin: 0 auto 150px;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.3);
        }
        #preview-content {
            background: white; height: 100%; min-height: 580px;
            overflow-y: auto; padding: 20px; outline: none; border-radius: 32px;
        }

        /* æè‡´çš„é€‰ä¸­è§†è§‰åé¦ˆ */
        .block-item { 
            position: relative; margin-bottom: 10px; padding: 10px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            cursor: pointer; border: 2px solid transparent; border-radius: 12px;
        }
        .block-item:hover { background-color: #f8fafc; border-color: #e2e8f0; }
        
        /* é€‰ä¸­çŠ¶æ€ï¼šæ˜äº®è“æ¡† + é˜´å½± + æ‰“é’© */
        .block-item.selected { 
            border-color: var(--primary) !important;
            background-color: #eff6ff !important;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        .block-item.selected::after {
            content: 'âœ“'; position: absolute; top: -8px; right: -8px;
            background: var(--primary); color: white; width: 22px; height: 22px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* åº•éƒ¨å·¥å…·æ å¸ƒå±€ */
        .bottom-workbench {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-top: 1px solid #e2e8f0;
            z-index: 999;
            padding: 16px 20px calc(16px + env(safe-area-inset-bottom));
        }

        .style-btn { 
            @apply px-4 py-2 bg-white hover:bg-blue-50 text-slate-700 text-xs rounded-xl border border-slate-200 shadow-sm transition-all font-bold whitespace-nowrap flex-shrink-0;
        }
        .style-btn:active { transform: scale(0.9); }
        .style-btn.danger { @apply bg-red-50 text-red-600 border-red-100; }
        .style-btn.primary { @apply bg-blue-600 text-white border-blue-600; }

        .theme-card.active { border-color: var(--primary); background: #f0f7ff; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-40">

    <div class="max-w-6xl mx-auto py-8 px-4">
        <header class="mb-10 flex flex-col md:flex-row justify-between items-center gap-6">
            <h1 class="text-3xl font-black tracking-tighter text-slate-800 underline decoration-blue-500">AI æ’ç‰ˆä¸“å®¶ v7.0</h1>
            <div class="flex items-center gap-3">
                <input type="password" id="api-key" oninput="saveConfig()" class="p-2.5 border rounded-2xl text-xs w-64 shadow-inner outline-none focus:ring-2 focus:ring-blue-400" placeholder="å¡«å…¥ DeepSeek API Key">
                <button onclick="clearStorage()" class="text-xs text-slate-400 hover:text-red-500">æ¸…ç©ºç¼“å­˜</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
            <div class="lg:col-span-7 space-y-8">
                <div class="bg-white p-8 rounded-[2rem] shadow-xl shadow-slate-200/50 border border-slate-100 space-y-8">
                    <div class="space-y-4">
                        <label class="text-sm font-black text-slate-400 uppercase">1. é€‰æ‹©ä¸»é¢˜é£æ ¼</label>
                        <div class="grid grid-cols-3 gap-4">
                            <button onclick="selectTheme('tech')" id="theme-tech" class="theme-card active border-2 p-4 rounded-2xl text-center">
                                <span class="block text-2xl">ğŸ”µ</span><span class="text-xs font-bold">ç§‘æŠ€è“</span>
                            </button>
                            <button onclick="selectTheme('fresh')" id="theme-fresh" class="theme-card border-2 p-4 rounded-2xl text-center">
                                <span class="block text-2xl">ğŸŒ¿</span><span class="text-xs font-bold">æ¸…æ–°ç»¿</span>
                            </button>
                            <button onclick="selectTheme('festive')" id="theme-festive" class="theme-card border-2 p-4 rounded-2xl text-center">
                                <span class="block text-2xl">ğŸ§§</span><span class="text-xs font-bold">æ·¡å–œåº†</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <label class="text-sm font-black text-slate-400 uppercase">2. ç²˜è´´æ–‡ç« å†…å®¹</label>
                        <textarea id="user-input" class="w-full h-80 p-6 bg-slate-50 border-none rounded-[1.5rem] outline-none focus:ring-2 focus:ring-blue-500 transition-all text-lg leading-relaxed" placeholder="åœ¨æ­¤è¾“å…¥æ–‡å­—..."></textarea>
                    </div>
                    
                    <button id="btn-run" onclick="generateArticle()" class="w-full py-5 bg-slate-900 text-white rounded-2xl font-black text-xl hover:shadow-2xl active:scale-95 transition-all">
                        ğŸš€ ä¸€é”® AI å…¨è‡ªåŠ¨æ™ºèƒ½æ’ç‰ˆ
                    </button>
                </div>
            </div>

            <div class="lg:col-span-5">
                <div class="sticky top-8">
                    <div class="flex justify-between mb-4 items-center px-6">
                        <span class="text-xs font-bold text-slate-400 italic">iPhone 15 Pro Max Preview</span>
                        <button onclick="copyHtml()" class="bg-green-500 text-white px-8 py-2.5 rounded-full font-black text-sm shadow-xl hover:bg-green-600 transition-all active:scale-90">ä¸€é”®å¤åˆ¶</button>
                    </div>
                    <div id="preview-container">
                        <div id="preview-content" contenteditable="true" onclick="handleBlockClick(event)">
                            <div class="flex flex-col items-center justify-center h-full text-slate-300 pt-40">
                                <p>AI æ’ç‰ˆç»“æœå°†æ˜¾ç¤ºåœ¨æ­¤...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-workbench shadow-[0_-20px_40px_rgba(0,0,0,0.1)]">
        <div class="max-w-6xl mx-auto space-y-4">
            <div class="flex justify-between items-center px-2">
                <span class="text-[10px] font-black text-slate-400 tracking-tighter uppercase">å·²é€‰ä¸­å—çš„æ“ä½œå°</span>
                <div class="flex gap-4">
                    <button onclick="selectAll()" class="text-[11px] text-blue-600 font-bold">å…¨é€‰æ‰€æœ‰å—</button>
                    <button onclick="clearSelection()" class="text-[11px] text-slate-400 font-bold">å–æ¶ˆé€‰ä¸­</button>
                </div>
            </div>
            <div class="flex gap-3 overflow-x-auto no-scrollbar pb-1">
                <button onclick="applyTemplate('normal')" class="style-btn danger">ğŸ—‘ï¸ æ¸…é™¤æ ¼å¼</button>
                <div class="w-[2px] bg-slate-200 mx-1"></div>
                <button onclick="applyTemplate('big_title')" class="style-btn">å¤§æ ‡é¢˜</button>
                <button onclick="applyTemplate('sub_title')" class="style-btn">å°æ ‡é¢˜</button>
                <button onclick="applyTemplate('num_title')" class="style-btn">æ•°å­—æ ‡</button>
                <button onclick="applyTemplate('grad_title')" class="style-btn">æ¸å˜æ ‡</button>
                <button onclick="applyTemplate('key_point')" class="style-btn">é‡ç‚¹å¡</button>
                <button onclick="applyTemplate('quote')" class="style-btn">å¼•ç”¨</button>
                <button onclick="applyTemplate('code_block')" class="style-btn">ä»£ç </button>
                <button onclick="applyTemplate('bg_card')" class="style-btn">åº•è‰²å¡</button>
                <div class="w-[2px] bg-slate-200 mx-1"></div>
                <button onclick="mergeSelected()" class="style-btn primary">ğŸ§© åˆå¹¶é€‰ä¸­æ®µè½</button>
            </div>
        </div>
    </div>

    <script>
        let currentTheme = 'tech';
        let selectedElements = new Set();

        const THEME_COLORS = {
            tech: { main: '#3b82f6', bg: '#eff6ff', border: '#bfdbfe', text: '#1e40af' },
            fresh: { main: '#10b981', bg: '#f0fdf4', border: '#bbf7d0', text: '#065f46' },
            festive: { main: '#ef4444', bg: '#fef2f2', border: '#fecaca', text: '#991b1b' }
        };

        window.onload = () => {
            const savedKey = localStorage.getItem('ds_api_key');
            if (savedKey) document.getElementById('api-key').value = savedKey;
        };

        function selectTheme(t) {
            currentTheme = t;
            document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`theme-${t}`).classList.add('active');
        }

        function saveConfig() { localStorage.setItem('ds_api_key', document.getElementById('api-key').value); }
        function clearStorage() { localStorage.clear(); location.reload(); }

        // æ ¸å¿ƒæ’ç‰ˆå¼•æ“
        function getTemplate(type, text) {
            const c = THEME_COLORS[currentTheme];
            // ç²¾ç»†åŒ–æ®µè½å¤„ç†
            const formattedText = text.split('\n').filter(l => l.trim()).map(line => `<p style="margin-bottom:0.8em; line-height:1.8;">${line}</p>`).join('');
            
            const tpls = {
                big_title: `<section class="block-item" style="margin: 2em 0 1.2em; text-align: center;"><h1 style="font-size: 24px; color: #111; border-bottom: 3px solid ${c.main}; display: inline-block; padding-bottom: 8px; font-weight:bold;">${text}</h1></section>`,
                sub_title: `<section class="block-item" style="margin: 1.8em 0 1em; padding-left: 15px; border-left: 6px solid ${c.main}; text-align:left;"><h2 style="font-size: 20px; color: #1e293b; margin: 0; font-weight:bold;">${text}</h2></section>`,
                num_title: `<section class="block-item" style="margin: 1.5em 0; display: flex; align-items: center; text-align:left;"><span style="background: ${c.main}; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; flex-shrink:0;">N</span><h3 style="font-size: 19px; color: #333; margin:0; font-weight:bold;">${text}</h3></section>`,
                grad_title: `<section class="block-item" style="margin: 1.5em 0; background: linear-gradient(90deg, ${c.bg} 0%, rgba(255,255,255,0) 100%); padding: 15px; border-radius: 8px; text-align:left;"><h2 style="font-size: 19px; color: ${c.main}; margin: 0; font-weight:bold;">${text}</h2></section>`,
                key_point: `<section class="block-item" style="margin: 1.5em 0; padding: 22px; border: 2px solid ${c.border}; background: ${c.bg}; border-radius: 16px; color: ${c.text}; text-align:left;"><strong style="display:block; margin-bottom:10px; font-size:18px;">ğŸ“ é‡ç‚¹ç»“è®º</strong><div>${formattedText}</div></section>`,
                quote: `<section class="block-item" style="margin: 1.5em 0; padding: 18px; border-left: 5px solid #cbd5e1; color: #64748b; font-style: italic; background: #f8fafc; text-align:left;">${formattedText}</section>`,
                code_block: `<section class="block-item" style="margin: 1.5em 0; padding: 18px; background: #1e293b; color: #e2e8f0; border-radius: 10px; font-family: monospace; font-size: 14px; white-space: pre-wrap; text-align:left;">${text}</section>`,
                bg_card: `<section class="block-item" style="margin: 1.5em 0; padding: 22px; background: #f8fafc; border-radius: 16px; border: 1px solid #e2e8f0; text-align:left;">${formattedText}</section>`,
                normal: `<section class="block-item" style="margin: 1.2em 0; line-height: 1.8; font-size: 16px; color: #374151; text-align: justify;">${formattedText}</section>`
            };
            return tpls[type] || tpls.normal;
        }

        // AI ç”Ÿæˆæµç¨‹
        async function generateArticle() {
            const apiKey = document.getElementById('api-key').value;
            const text = document.getElementById('user-input').value;
            const btn = document.getElementById('btn-run');
            if (!apiKey || !text) return alert("API Key æˆ–å†…å®¹ç¼ºå¤±");

            btn.disabled = true;
            btn.innerText = "â³ AI æ­£åœ¨æ·±åº¦æ‰«æå¹¶æ’ç‰ˆ...";

            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: "ä½ æ˜¯ä¸€ä¸ªæ’ç‰ˆå¸ˆã€‚å°†æ–‡æœ¬æ‹†åˆ†ä¸ºJSONæ•°ç»„ï¼ŒåŒ…å«typeå’Œcontentå­—æ®µã€‚typeé€‰ï¼šbig_title, sub_title, num_title, key_point, quote, bg_card, normalã€‚ä¿æŒé€»è¾‘æ®µè½ã€‚åªè¿”å›JSONã€‚" },
                            { role: "user", content: text }
                        ]
                    })
                });
                const data = await response.json();
                const rawJson = data.choices[0].message.content.match(/\[[\s\S]*\]/)[0];
                const blocks = JSON.parse(rawJson);
                
                const container = document.getElementById('preview-content');
                container.innerHTML = '';
                blocks.forEach(b => {
                    const temp = document.createElement('div');
                    temp.innerHTML = getTemplate(b.type, b.content);
                    const el = temp.firstElementChild;
                    el.setAttribute('data-raw', b.content);
                    container.appendChild(el);
                });
            } catch (e) {
                alert("AI æ’ç‰ˆå¼‚å¸¸ï¼Œè½¬å…¥åŸºç¡€æ¨¡å¼");
                renderFallback(text);
            } finally {
                btn.disabled = false;
                btn.innerText = "ğŸš€ ä¸€é”® AI å…¨è‡ªåŠ¨æ™ºèƒ½æ’ç‰ˆ";
            }
        }

        function renderFallback(text) {
            const container = document.getElementById('preview-content');
            container.innerHTML = text.split('\n\n').map(p => {
                const tpl = getTemplate('normal', p);
                return tpl.replace('class="block-item"', `class="block-item" data-raw="${p.replace(/"/g, '&quot;')}"`);
            }).join('');
        }

        // äº¤äº’é€»è¾‘ï¼šæ”¯æŒå¤šé€‰ä¸çŠ¶æ€ä¿æŒ
        function handleBlockClick(e) {
            const block = e.target.closest('.block-item');
            if (!block) return;
            
            if (block.classList.contains('selected')) {
                block.classList.remove('selected');
                selectedElements.delete(block);
            } else {
                block.classList.add('selected');
                selectedElements.add(block);
            }
        }

        function applyTemplate(type) {
            if (selectedElements.size === 0) return alert("è¯·å…ˆç‚¹å‡»é¢„è§ˆåŒºçš„æ–‡å­—å—è¿›è¡Œé€‰æ‹©");
            
            const currentSelected = Array.from(selectedElements);
            currentSelected.forEach(el => {
                const rawText = el.getAttribute('data-raw') || el.innerText;
                const newHtml = getTemplate(type, rawText);
                const temp = document.createElement('div');
                temp.innerHTML = newHtml;
                const newEl = temp.firstElementChild;
                
                // å…³é”®ä¿®å¤ï¼šä¿æŒåŸå§‹æ•°æ®å¹¶é‡æ–°åŠ ä¸Šé€‰ä¸­çŠ¶æ€
                newEl.setAttribute('data-raw', rawText);
                newEl.classList.add('selected');
                
                el.replaceWith(newEl);
                selectedElements.delete(el);
                selectedElements.add(newEl);
            });
        }

        function mergeSelected() {
            if (selectedElements.size < 2) return alert("è¯·è‡³å°‘é€‰ä¸­ä¸¤æ®µè¿›è¡Œåˆå¹¶");
            const sorted = Array.from(selectedElements).sort((a, b) => a.offsetTop - b.offsetTop);
            const mergedText = sorted.map(el => el.getAttribute('data-raw') || el.innerText).join('\n\n');
            const first = sorted[0];
            
            const newElMarkup = getTemplate('normal', mergedText);
            const temp = document.createElement('div');
            temp.innerHTML = newElMarkup;
            const newEl = temp.firstElementChild;
            newEl.setAttribute('data-raw', mergedText);
            newEl.classList.add('selected');
            
            first.replaceWith(newEl);
            sorted.slice(1).forEach(el => el.remove());
            selectedElements.clear();
            selectedElements.add(newEl);
        }

        function selectAll() {
            document.querySelectorAll('.block-item').forEach(el => {
                el.classList.add('selected');
                selectedElements.add(el);
            });
        }

        function clearSelection() {
            selectedElements.forEach(el => el.classList.remove('selected'));
            selectedElements.clear();
        }

        async function copyHtml() {
            const content = document.getElementById('preview-content').cloneNode(true);
            content.querySelectorAll('.block-item').forEach(el => {
                el.classList.remove('selected');
                el.removeAttribute('data-raw');
            });
            const blob = new Blob([content.innerHTML], { type: "text/html" });
            const data = [new ClipboardItem({ ["text/html"]: blob })];
            await navigator.clipboard.write(data);
            alert("âœ… æ’ç‰ˆå·²é”å®šåˆ°å‰ªè´´æ¿ï¼Œè¯·å‰å¾€åå°ç²˜è´´ï¼");
        }
    </script>
</body>
</html>
