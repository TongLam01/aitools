<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI çµæ„Ÿæ’ç‰ˆå¤§å¸ˆ v12.1 - æœ€ç»ˆç¨³å®šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #ff4d4f; }
        
        #preview-container { 
            background: #111; min-height: 600px; border-radius: 40px;
            padding: 10px; border: 6px solid #333; max-width: 375px; margin: 0 auto 180px;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.4); position: relative;
        }
        #preview-content {
            background: white; height: 100%; min-height: 580px;
            overflow-y: auto; padding: 20px 0; outline: none; border-radius: 32px;
        }

        /* çº¢è‰²è™šçº¿é€‰ä¸­æ€ */
        .block-item { 
            position: relative; margin-bottom: 4px; padding: 10px 0;
            transition: all 0.2s ease; cursor: pointer; border: 2px dashed transparent;
        }
        .block-item.selected { 
            border-color: var(--primary) !important;
            background-color: rgba(255, 77, 79, 0.02);
        }
        /* é€‰ä¸­æ ‡è®° */
        .block-item.selected::after {
            content: attr(data-status);
            position: absolute; top: -12px; right: 10px;
            background: var(--primary); color: white; font-size: 10px;
            padding: 2px 8px; border-radius: 4px; font-weight: bold; z-index: 50;
        }

        .bottom-workbench {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px); border-top: 1px solid #eee;
            z-index: 999; padding: 16px 20px calc(16px + env(safe-area-inset-bottom));
        }

        .style-btn { @apply px-3 py-2 bg-white hover:bg-slate-50 text-slate-700 text-xs rounded-xl border border-slate-200 shadow-sm transition-all font-bold whitespace-nowrap; }
        .color-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 0 0 1px #ddd; transition: 0.2s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-48">

    <div class="max-w-7xl mx-auto py-8 px-4">
        <header class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-black text-slate-800 tracking-tighter italic">AI Editor <span class="text-red-500">v12.1</span></h1>
            </div>
            
            <div class="flex items-center gap-2 cursor-pointer group" onclick="toggleSettings()">
                <span class="text-[11px] font-bold text-slate-400 group-hover:text-slate-600 transition">âš™ï¸ API Key è®¾ç½®</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400 group-hover:text-slate-600 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </div>
        </header>

        <div id="settings-panel" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-[1000] flex items-center justify-center p-4">
            <div class="bg-white p-8 rounded-[2rem] shadow-2xl w-full max-w-md space-y-4">
                <h3 class="font-black text-xl text-center">API è®¾ç½®ä¸­å¿ƒ</h3>
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-400">DEEPSEEK API KEY</label>
                    <input type="password" id="api-key" oninput="saveConfig()" class="w-full p-4 bg-slate-100 border-none rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="sk-...">
                </div>
                <p class="text-[10px] text-slate-400 leading-relaxed">Key å·²åŠ å¯†ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨ localStorage ä¸­ã€‚å»ºè®®åœ¨ GitHub Pages (HTTPS) ç¯å¢ƒä¸‹ä½¿ç”¨ä»¥ç¡®ä¿è¯·æ±‚æˆåŠŸã€‚</p>
                <button onclick="toggleSettings()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-lg active:scale-95 transition-all">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <div class="lg:col-span-7 space-y-6 text-left">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border border-slate-100 space-y-4">
                    <textarea id="user-input" class="w-full h-[520px] p-6 bg-slate-50 border-none rounded-[1.5rem] outline-none focus:bg-white transition-all text-lg leading-relaxed" placeholder="åœ¨æ­¤ç²˜è´´åŸå§‹å†…å®¹..."></textarea>
                    <button onclick="generateArticle()" id="btn-run" class="w-full py-5 bg-slate-900 text-white rounded-2xl font-black text-xl hover:shadow-2xl transition-all">
                        ğŸš€ ä¸€é”® AI æ™ºèƒ½å…¨è§£æ
                    </button>
                </div>
            </div>

            <div class="lg:col-span-5 text-center">
                <div class="sticky top-6">
                    <div class="flex justify-between mb-4 items-center px-4">
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Stable WeChat Preview</span>
                        <button onclick="copyHtml()" class="bg-green-600 text-white px-8 py-2 rounded-full font-bold text-xs shadow-lg hover:bg-green-700">å¤åˆ¶å…¨éƒ¨ (é€‚é…å¾®ä¿¡)</button>
                    </div>
                    <div id="preview-container">
                        <div id="preview-content" contenteditable="true">
                            <div class="flex items-center justify-center h-full text-slate-200 italic pt-56">ç­‰å¾…ç”Ÿæˆæ’ç‰ˆç»“æœ...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-workbench shadow-[0_-20px_50px_rgba(0,0,0,0.1)]">
        <div class="max-w-6xl mx-auto space-y-4">
            <div class="flex flex-wrap items-center gap-4 border-b pb-3">
                <span class="text-[10px] font-black text-slate-400 uppercase tracking-tighter">é…è‰²æ–¹æ¡ˆ:</span>
                <div class="flex items-center gap-2" id="color-palette">
                    <div class="color-dot" style="background:#3b82f6" onclick="updateColor('#3b82f6')"></div>
                    <div class="color-dot" style="background:#10b981" onclick="updateColor('#10b981')"></div>
                    <div class="color-dot" style="background:#ef4444" onclick="updateColor('#ef4444')"></div>
                    <div class="color-dot" style="background:#f59e0b" onclick="updateColor('#f59e0b')"></div>
                </div>
                <div class="h-6 w-[1px] bg-slate-200"></div>
                <input type="color" id="custom-color" oninput="updateColor(this.value)" class="w-6 h-6 border-none cursor-pointer bg-transparent p-0">
                <div id="recent-colors" class="flex gap-2 items-center"></div>
            </div>

            <div class="flex justify-between items-center px-1">
                <div class="flex gap-4">
                    <button onclick="selectAll()" class="text-[10px] text-slate-800 font-bold hover:underline">å…¨é€‰</button>
                    <button onclick="clearSelection()" class="text-[10px] text-slate-400 font-bold hover:underline">å–æ¶ˆ</button>
                </div>
                <span class="text-[10px] text-red-500 font-bold italic">ğŸ’¡ ç‚¹å‡»åŒä¸€æ ·å¼æŒ‰é’®å¯å¾ªç¯åˆ‡æ¢å¤–è§‚</span>
            </div>
            
            <div class="flex gap-3 overflow-x-auto no-scrollbar pb-1">
                <button onclick="applyVariant('normal')" class="style-btn text-red-500">ğŸ—‘ï¸ è¿˜åŸæ­£æ–‡</button>
                <div class="w-[1px] bg-slate-200 mx-1"></div>
                <button onclick="applyVariant('big_title')" class="style-btn">âœ¦ å¤§æ ‡é¢˜</button>
                <button onclick="applyVariant('sub_title')" class="style-btn">â—ˆ å°æ ‡é¢˜</button>
                <button onclick="applyVariant('num_title')" class="style-btn">â¶ åºå·æ ‡</button>
                <button onclick="applyVariant('grad_title')" class="style-btn">â–£ æ¸å˜æ ‡</button>
                <button onclick="applyVariant('key_point')" class="style-btn">â˜… é‡ç‚¹å¡</button>
                <button onclick="applyVariant('quote')" class="style-btn">â å¼•ç”¨å—</button>
                <button onclick="applyVariant('code_block')" class="style-btn">âŒ¨ ä»£ç å—</button>
                <button onclick="applyVariant('bg_card')" class="style-btn">â–§ åº•è‰²å¡</button>
                <div class="w-[1px] bg-slate-200 mx-1"></div>
                <button onclick="mergeSelected()" class="style-btn bg-slate-800 text-white border-none">ğŸ§© åˆå¹¶å†…å®¹</button>
            </div>
        </div>
    </div>

    <script>
        let currentColor = '#3b82f6';
        let recentColors = JSON.parse(localStorage.getItem('recent_colors_v12') || '[]');
        const STYLE_NAMES = { big_title: "å¤§æ ‡é¢˜", sub_title: "å°æ ‡é¢˜", num_title: "åºå·æ ‡", grad_title: "æ¸å˜æ ‡", key_point: "é‡ç‚¹å¡", quote: "å¼•ç”¨å—", code_block: "ä»£ç å—", bg_card: "åº•è‰²å¡", normal: "æ­£æ–‡" };

        // å¾®ä¿¡é«˜å…¼å®¹æ€§æ¨¡æ¿åº“
        const VARIANTS = {
            big_title: [
                (txt, c) => `<div style="text-align: center; padding: 0 8px; margin: 1em 0;"><div style="font-size: 24px; color: ${c}; margin-bottom: 5px;">âœ¦</div><h1 style="font-size: 22px; color: #111; border-bottom: 3px solid ${c}; display: inline-block; padding: 0 15px 8px; font-weight:bold; margin: 0;">${txt}</h1></div>`,
                (txt, c) => `<div style="text-align: center; padding: 0 8px; margin: 1em 0;"><h1 style="font-size: 20px; color: white; background-color: ${c}; padding: 10px 20px; border-radius: 4px; display: inline-block; font-weight:bold; margin: 0;">${txt}</h1></div>`
            ],
            sub_title: [
                (txt, c) => `<div style="padding: 0 8px; margin: 1.5em 0;"><div style="border-left: 5px solid ${c}; padding-left: 12px; text-align:left;"><h2 style="font-size: 19px; color: #1e293b; font-weight:bold; margin:0;">${txt}</h2></div></div>`,
                (txt, c) => `<div style="padding: 0 8px; margin: 1.5em 0;"><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td width="20" valign="middle" style="text-align:left;"><span style="color:${c}; font-size:20px;">â—†</span></td><td valign="middle" style="border-bottom:1px dashed ${c}; padding-bottom:4px; text-align:left;"><h2 style="font-size: 19px; color: #1e293b; font-weight:bold; margin:0;">${txt}</h2></td></tr></table></div>`
            ],
            num_title: [
                (txt, c) => `<div style="padding: 0 8px; margin: 1.2em 0; text-align:left;"><table border="0" cellspacing="0" cellpadding="0"><tr><td valign="middle" style="padding-right:12px;"><span style="background-color:${c}; color:white; width:26px; height:26px; border-radius:13px; display:inline-block; text-align:center; line-height:26px; font-weight:bold; font-size:14px;">1</span></td><td valign="middle"><h3 style="font-size:18px; font-weight:bold; color:#333; margin:0;">${txt}</h3></td></tr></table></div>`
            ],
            key_point: [
                (txt, c) => `<div style="margin:1.5em 8px; padding: 22px; border:2px solid ${c}; background-color:${c}08; border-radius:16px; text-align:left; box-sizing:border-box;">${format(txt)}</div>`
            ],
            quote: [
                (txt, c) => `<div style="margin:1.5em 8px; padding:15px 20px; border-left:4px solid ${c}; color:#555; background-color:#f9f9f9; font-style:italic; text-align:left; box-sizing:border-box;">${format(txt)}</div>`
            ],
            normal: [(txt, c) => `<div style="padding: 0 8px; margin:1.2em 0; line-height:1.8; font-size:16px; color:#374151; text-align:justify; box-sizing:border-box;">${format(txt)}</div>`],
            grad_title: [(txt, c) => `<div style="padding: 0 8px; margin: 1.2em 0; text-align:left;"><div style="background-color: ${c}; padding:8px 15px; border-radius:4px; color:white; font-weight:bold; display:inline-block;">${txt}</div></div>`],
            code_block: [(txt, c) => `<div style="margin: 1.5em 8px; padding:15px; background-color:#2d3436; color:#dfe6e9; border-radius:8px; font-family:monospace; border-top:4px solid ${c}; text-align:left; font-size:13px;">${txt}</div>`],
            bg_card: [(txt, c) => `<div style="margin:1.5em 8px; padding:20px; background-color:${c}10; border-radius:15px; border-right:4px solid ${c}; text-align:left;">${format(txt)}</div>`]
        };

        function format(t) { return t.split('\n').filter(l=>l.trim()).map(l=>`<p style="margin-bottom:0.8em; margin-top:0;">${l}</p>`).join(''); }

        window.onload = () => {
            const savedKey = localStorage.getItem('ds_api_key_v12');
            if (savedKey) document.getElementById('api-key').value = savedKey;
            renderRecentColors();
        };

        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('hidden'); }
        function saveConfig() { localStorage.setItem('ds_api_key_v12', document.getElementById('api-key').value); }

        function updateColor(color) {
            currentColor = color;
            document.getElementById('custom-color').value = color;
            const selected = document.querySelectorAll('.block-item.selected');
            selected.forEach(el => applyVariantToElement(el, el.getAttribute('data-type') || 'normal', true));
            addToRecent(color);
        }

        function addToRecent(c) {
            recentColors = [c, ...recentColors.filter(x=>x!==c)].slice(0,5);
            localStorage.setItem('recent_colors_v12', JSON.stringify(recentColors));
            renderRecentColors();
        }

        function renderRecentColors() {
            const container = document.getElementById('recent-colors');
            container.innerHTML = recentColors.length ? '<span class="text-[10px] text-slate-300">æœ€è¿‘:</span>' : '';
            recentColors.forEach(c => {
                const dot = document.createElement('div');
                dot.className = 'color-dot'; dot.style.background = c;
                dot.onclick = () => updateColor(c);
                container.appendChild(dot);
            });
        }

        // ç»Ÿä¸€ç‚¹å‡»é€‰ä¸­
        document.getElementById('preview-content').addEventListener('click', function(e) {
            const block = e.target.closest('.block-item');
            if (block) {
                block.classList.toggle('selected');
                updateBadge(block);
            }
        });

        function updateBadge(el) {
            if (el.classList.contains('selected')) {
                const type = el.getAttribute('data-type') || 'normal';
                const vIdx = parseInt(el.getAttribute('data-variant') || 0);
                el.setAttribute('data-status', `âœ“ ${STYLE_NAMES[type]} (${vIdx + 1}/${VARIANTS[type].length})`);
            } else { el.removeAttribute('data-status'); }
        }

        function applyVariant(type) {
            const selected = document.querySelectorAll('.block-item.selected');
            if (selected.length === 0) return alert("è¯·å…ˆåœ¨é¢„è§ˆåŒºç‚¹å‡»å†…å®¹å—è¿›è¡Œé€‰æ‹©");
            selected.forEach(el => applyVariantToElement(el, type, false));
        }

        function applyVariantToElement(el, type, isColorOnly) {
            const rawText = el.getAttribute('data-raw') || el.innerText;
            const prevType = el.getAttribute('data-type');
            let vIdx = parseInt(el.getAttribute('data-variant') || 0);

            if (!isColorOnly) {
                vIdx = (prevType === type) ? (vIdx + 1) % VARIANTS[type].length : 0;
            }

            const newSec = document.createElement('section');
            newSec.className = 'block-item selected';
            newSec.setAttribute('data-type', type);
            newSec.setAttribute('data-variant', vIdx);
            newSec.setAttribute('data-raw', rawText);
            newSec.innerHTML = VARIANTS[type][vIdx](rawText, currentColor);
            
            el.replaceWith(newSec);
            updateBadge(newSec);
        }

        // æ ¸å¿ƒä¿®å¤ç‰ˆ AI è§£æ
        async function generateArticle() {
            const apiKey = document.getElementById('api-key').value;
            const text = document.getElementById('user-input').value;
            if(!apiKey || !text) return alert("è¯·ç‚¹å‡»å³ä¸Šè§’è®¾ç½® API Key å¹¶è¾“å…¥å†…å®¹");
            
            const btn = document.getElementById('btn-run');
            btn.disabled = true;
            btn.innerText = "â³ AI æ­£åœ¨æ·±åº¦è§£æ...";

            try {
                const res = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {role: "system", content: "ä½ æ˜¯ä¸€ä¸ªæ’ç‰ˆè§£æå™¨ã€‚å°†æ–‡æœ¬æ‹†åˆ†ä¸ºJSONæ•°ç»„ï¼ŒåŒ…å«typeå’Œcontentå­—æ®µã€‚ä¸¥ç¦å¢åŠ åŸæ–‡ä»¥å¤–çš„ä»»ä½•å¤§æ ‡é¢˜æˆ–æ€»ç»“è¯ï¼Œä¿æŒç”¨æˆ·è¾“å…¥çš„åŸè¯ã€‚JSONæ ¼å¼å¿…é¡»ä¸¥æ ¼ã€‚"},
                            {role: "user", content: text}
                        ],
                        temperature: 0.1
                    })
                });

                if (!res.ok) {
                    const errData = await res.json();
                    throw new Error(errData.error.message || "è¯·æ±‚å¤±è´¥");
                }

                const data = await res.json();
                const jsonText = data.choices[0].message.content.match(/\[[\s\S]*\]/);
                if (!jsonText) throw new Error("AI è¿”å›æ ¼å¼ä¸æ­£ç¡®");

                const blocks = JSON.parse(jsonText[0]);
                const container = document.getElementById('preview-content');
                container.innerHTML = '';
                blocks.forEach(b => {
                    const sec = document.createElement('section');
                    sec.className = 'block-item';
                    sec.setAttribute('data-type', b.type);
                    sec.setAttribute('data-variant', '0');
                    sec.setAttribute('data-raw', b.content);
                    sec.innerHTML = VARIANTS[b.type] ? VARIANTS[b.type][0](b.content, currentColor) : VARIANTS.normal[0](b.content, currentColor);
                    container.appendChild(sec);
                });
            } catch(e) { 
                alert("è§£æå¤±è´¥ï¼š" + e.message + "\nè¯·æ£€æŸ¥ä½™é¢ã€Key æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç½‘ç»œæ˜¯å¦é¡ºç•…ã€‚"); 
            } finally { 
                btn.disabled = false; btn.innerText = "ğŸš€ ä¸€é”® AI æ™ºèƒ½å…¨è§£æ"; 
            }
        }

        async function copyHtml() {
            const content = document.getElementById('preview-content').cloneNode(true);
            content.querySelectorAll('.block-item').forEach(el => {
                el.classList.remove('selected');
                ['data-raw', 'data-status', 'data-type', 'data-variant'].forEach(attr => el.removeAttribute(attr));
            });
            const blob = new Blob([content.innerHTML], { type: "text/html" });
            const data = [new ClipboardItem({ ["text/html"]: blob })];
            await navigator.clipboard.write(data);
            alert("âœ… æ’ç‰ˆå·²å¤åˆ¶ï¼Œå®Œç¾é€‚é…å¾®ä¿¡ç¼–è¾‘å™¨ï¼");
        }

        function selectAll() { document.querySelectorAll('.block-item').forEach(el => { el.classList.add('selected'); updateBadge(el); }); }
        function clearSelection() { document.querySelectorAll('.block-item.selected').forEach(el => { el.classList.remove('selected'); updateBadge(el); }); }
        
        function mergeSelected() {
            const selected = Array.from(document.querySelectorAll('.block-item.selected')).sort((a,b)=>a.offsetTop - b.offsetTop);
            if (selected.length < 2) return alert("è¯·è‡³å°‘é€‰ä¸­ä¸¤æ®µè¿›è¡Œåˆå¹¶");
            const merged = selected.map(el => el.getAttribute('data-raw')).join('\n\n');
            const sec = document.createElement('section');
            sec.className = 'block-item selected';
            sec.setAttribute('data-type', 'normal');
            sec.setAttribute('data-variant', '0');
            sec.setAttribute('data-raw', merged);
            sec.innerHTML = VARIANTS.normal[0](merged, currentColor);
            selected[0].replaceWith(sec);
            selected.slice(1).forEach(el => el.remove());
            updateBadge(sec);
        }
    </script>
</body>
</html>
